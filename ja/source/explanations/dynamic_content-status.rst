.. _exp-dynamic-content-status:

############################################
ステータス・メッセージとスクリーン・リーダー
############################################

ステータス・メッセージは、状況に応じて動的に表示されたり変更されたりします。
画面表示を見ることができない場合、このような動的な変化を認知することが不可能です。

この問題を回避するために、ステータス・メッセージについてスクリーン・リーダーなどの支援技術が適切に処理できるようにすることが求められています。
具体的には、以下に示すARIAライブ・リージョンを活用することで、自動的に読み上げられるようにすることが必要です。

なお、このステータス・メッセージに関するWCAG 2.1の達成基準はレベルAAとされていますが、freeeのプロダクトにおいては操作の結果をユーザーに知らせる場合など、比較的重要な場面でステータス・メッセージが活用されていますので、当ガイドラインではこの達成基準をレベルA相当のものとしています。

**********************************************
ARIAライブ・リージョンの実装例と利用時の注意点
**********************************************

ステータス・メッセージなど、自動的に読み上げられるようにする必要があるコンテンツがある場合は、ARIAライブ・リージョンを用います。

``aria-live`` 属性が指定されているか、 ``role`` 属性で ``status``, ``alert``, ``log`` などの特定の値が指定されている要素があると、これらがARIAライブ・リージョンとして扱われます。
ARIAライブ・リージョンがページ中にあると、スクリーン・リーダーはその要素を監視して、内容に変化があると読み上げることが期待されています。

参考： `ARIA ライブリージョン - アクセシビリティ | MDN <https://developer.mozilla.org/ja/docs/Web/Accessibility/ARIA/ARIA_Live_Regions>`_

基本的な実装例
==============

以下のコードが、もっとも基本的な実装です。

`aria-live-basic.html <../_static/samples/aria-live-basic.html>`_ ：

.. raw:: html

   <details><summary>コードを表示</summary>

.. include:: ../_static/samples/aria-live-basic.html
    :code: html
    :number-lines:
    :literal:

.. raw:: html

   </details>

20行目の空の ``div`` 要素がARIAライブ・リージョンです。

.. raw:: html

   <p>以下は上記のコードを表示したもので、「ページを更新」を押下するとARIAライブ・リージョンがサポートされている環境では、追加されたメッセージが読み上げられます。</p>
   <iframe src="../_static/samples/aria-live-basic.html" width="100%" height="320px"></iframe>

注意：ページのロード時にARIAライブ・リージョンが存在しないと読み上げられない
============================================================================

基本的に、ARIAライブ・リージョンはページのロード時に存在することが期待されています。
そのため、メッセージを表示するのと同時に ``aria-live`` 属性が付いた要素を追加しても、適切に読み上げられません。
一部読み上げられる環境が存在するという情報もありますが、本稿執筆時、NVDA日本語版2020.3とGoogle Chromeの組み合わせでは読み上げられないことを確認しています。

しかし、以下のようにARIAライブ・リージョンの設置とその内容の更新に時間差を与えると、NVDAでも読み上げられることを確認しています。

`aria-live-timer.html <../_static/samples/aria-live-timer.html>`_ ：

.. raw:: html

   <details><summary>コードを表示</summary>

.. include:: ../_static/samples/aria-live-timer.html
    :code: html
    :number-lines:
    :literal:

.. raw:: html

   </details>

この方法を用いる場合、以下の点に注意が必要です。

*  ARIAライブ・リージョンの挿入と その内容の更新との時間差を発生させる際、 ``while`` 分を使った手法では読み上げられず、 ``setTimeout()`` などを使う必要がある。
*  上記サンプルでは時間差を1msとしているが、実装状況や利用環境によってはもっと長い時間差が必要な場合が考えられる。
*  この手法では読み上げられない環境が存在する可能性がある。

このように、後からARIAライブ・リージョンを挿入する手法には不確実な点もあるので、なるべくページのロード時にARIAライブ・リージョンを設置するようにするのが良いでしょう。

.. include:: /inc/info2gl/exp-dynamic-content-status.rst
